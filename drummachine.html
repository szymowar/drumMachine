<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Drum Machine</title>
    <link rel="stylesheet" href="drummachine.css">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>
</head>
<body>
    <div id="root">
        </div>
        <script type="text/babel">

const sounds = [
    {
        keytriggered : "Q",
        keycode : 81,
        soundname: 'african',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/90[kb]african-pe-lo.wav.mp3'
    },
    {
        keytriggered : "W",
        keycode : 87,
        soundname: 'bongo',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/23[kb]bongo%20lo.aif.mp3'
    },
    {
        keytriggered : "E",
        keycode : 69,
        soundname: 'crikix',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/65[kb]crikix.aif.mp3'
    },
    {
        keytriggered : "A",
        keycode : 65,
        soundname: 'electro',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/309[kb]electrotabla.aif.mp3'
    },
    {
        keytriggered : "S",
        keycode : 83,
        soundname: 'ethno',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/67[kb]ethnowhat.aif.mp3'
    },
    {
        keytriggered : "D",
        keycode : 68,
        soundname: 'gungru',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/107[kb]gungru5.aif.mp3'
    },
    {
        keytriggered : "Z",
        keycode : 90,
        soundname: 'lotabla',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/197[kb]lotabla.aif.mp3'
    },
    {
        keytriggered : "X",
        keycode : 88,
        soundname: 'rain',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/356[kb]rainstick.aif.mp3'
    },
    {
        keytriggered : "C",
        keycode : 67,
        soundname: 'steel',
        soundurl: 'https://sampleswap.org/samples-ghost/DRUMS%20and%20SINGLE%20HITS/percussion%20african%20and%20eastern/79[kb]steeldrum.aif.mp3'
        }
]


class Display extends React.Component {
    render() {
        return (<div id="display">{this.props.clipstring}</div>)
    }
}
class Drumpad extends React.Component {
    constructor(props){
        super(props);
        this.state ={
            baseClass : 'drum-pad'
        };
        this.activePadhandle = this.activePadhandle.bind(this);
        this.playsound = this.playsound.bind(this);
        this.handleKeyPress = this.handleKeyPress.bind(this);
    }

    componentDidMount(){
        window.addEventListener('keydown', this.handleKeyPress);
    }
    componentWillUnmount(){
        window.removeEventListener('keydown', this.handleKeyPress);
    }

    handleKeyPress(e){
        if(e.keyCode === this.props.keycode){
            this.playsound();
        }
        return;
    }
    playsound(){
        const audio = document.getElementById(this.props.keytriggered);
        audio.currentTime = 0;
        audio.play();
        this.activePadhandle();
        this.props.sendData(this.props.soundname);
    }

    activePadhandle() {
        this.setState({
            baseClass : 'drum-pad activePad'
        });
        setTimeout(() => this.setState({baseClass: 'drum-pad'}), 70);
    }

    render() {
        return (<div data-key={this.props.keycode}
                     id={this.props.soundname}
                     className={this.state.baseClass}
                     onClick={this.playsound}>
                     {this.props.keytriggered}
                <audio data-key={this.props.keycode}
                       id={this.props.keytriggered}
                       className='clip'
                       src={this.props.soundurl}>
                </audio>
                </div>)

    }
}


class DrumMachine extends React.Component {
    constructor(props){
        super(props);
        this.state = {
            currentClip: 'african'
        }
        this.displaySound = this.displaySound.bind(this);
        this.getData = this.getData.bind(this);
    }

    componentDidMount(){
        document.addEventListener('play', this.displaySound);
    }

    displaySound(e){
        this.setState({currentClip : console.log(e)})
    }

    getData(val){
        this.setState({currentClip: val});
    }
    render() {
        const drums = sounds.map((curr, i, arr) =>
            <Drumpad key={curr.toString()+i}
                     keytriggered={sounds[i].keytriggered}
                     keycode={sounds[i].keycode}
                     soundurl={sounds[i].soundurl}
                     soundname={sounds[i].soundname}
                     sendData={this.getData}
                    />
        );

        return(<div id="drum-machine">
            <div className="title">DRUM MACHINE</div>
            <Display clipstring={this.state.currentClip} />
            <div className="drum-container">
                {drums}
                </div>
        </div>)
    }
}

const root =  document.getElementById('root');
ReactDOM.render(<DrumMachine />, root)

    </script>
</body>
</html>
